{% extends 'base.html' %} {% block content %}

<div class="row text-center">
  <div class="col">
    <h1>
      Welcome to my first Python Project!
    </h1>
  </div>
</div>

<div class='row mb-3'>
  <div class='col-md-4 mx-auto col-10'>
    <form class='form' method="POST" action='/create-post'>
      {% csrf_token %}
      <input type='hidden' value='/' name='next'/>
      <textarea class='form-control' name='content' placeholder='Post...'></textarea>
      <button type='submit' class='btn btn-primary'>Post</button>
    </form>

  </div class='col-md-4'>
</div>

<div class="row" id="posts">
  Loading...
</div>

<script>
  const postsElement = document.getElementById('posts');
  // postsElement.innerHTML = 'Loading...';

  const xhr = new XMLHttpRequest();
  const method = 'GET';
  const url = '/posts';
  const responseType = 'json';

  const LikeBtn = (post) => {
    return (
      "<button class='btn btn-primary btn-small' onClick=handleLike(" +
      post.id +
      ',' +
      post.likes +
      ')>' +
      post.likes +
      ' Likes</button>'
    );
  };

  const handleLike = (post_id, currentCount) => {
    console.log(post_id, currentCount);
    return;
  };

  // const formatPostElement = (post) => {

  // }

  xhr.responseType = responseType;
  xhr.open(method, url);
  xhr.onload = () => {
    const serverResponse = xhr.response;
    const listedItems = serverResponse.response;

    const finalPostStr = listedItems.map((listedItem) => {
      return (
        "<div class='mb-4 home__post col-12 col-md-10 mx-auto border rounded py-3' id='post__" +
        listedItem.id +
        "'><p>" +
        listedItem.content +
        "</p><div class='btn-group'>" +
        LikeBtn(listedItem) +
        '</div></div>'
      );
    });

    postsElement.innerHTML = finalPostStr;
  };
  xhr.send();
</script>
{% endblock content %}
